# The Caddyfile is an easy way to configure your Caddy web server.
#
# https://caddyserver.com/docs/caddyfile


# The configuration below serves a welcome page over HTTP on port 80.  To use
# your own domain name with automatic HTTPS, ensure your A/AAAA DNS record is
# pointing to this machine's public IP, then replace `http://` with your domain
# name.  Refer to the documentation for full instructions on the address
# specification.
#
# https://caddyserver.com/docs/caddyfile/concepts#addresses
#archstat.com {
#
#    # Set this path to your site's directory.
#    root * /usr/share/caddy
#
#    # Enable the static file server.
#    file_server
#
#    # Another common task is to set up a reverse proxy:
#    # reverse_proxy localhost:8080
#
#    # Or serve a PHP site through php-fpm:
#    # php_fastcgi localhost:9000
#
#    # Refer to the directive documentation for more options.
#    # https://caddyserver.com/docs/caddyfile/directives
#
#}
#
# Global 配置
{
    log {
        output file /var/log/caddy/error.log {
            roll_size 200mb
            roll_keep 5
        }
        format json {
            time_format rfc3339
        }
        level ERROR
    }
}

(access_log) {
    log {
        output file /var/log/caddy/access.log {
            roll_size 1gb
            roll_keep 5
            roll_keep_for 720h
        }
        format json {
            time_format rfc3339
        }
    }
}


#  定义一个核心静态网站配置片段，它接受一个参数：args.0 作为网站的根目录
(static_site_core) {
     # 日志
    import access_log

    # 路径
    root * "{args[0]}"
    file_server
    try_files {path} {path}/index.html /index.html

    # 响应
    encode gzip
#    header Strict-Transport-Security "max-age=31536000;"
}

# 定义一个 www 重定向片段, 它接受一个参数：args.0 作为基础域名 (例如 tkstorm.com)
(www_redirect) {
    redir https://{args[0]}{uri} 301 # 永久重定向到 HTTPS 的基础域名
}

# As an alternative to editing the above site block, you can add your own site
# block files in the Caddyfile.d directory, and they will be included as long
# as they use the .caddyfile extension.
#import Caddyfile.d/*.caddyfile
import vhosts/*.caddyfile

